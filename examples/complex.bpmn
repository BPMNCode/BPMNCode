process ComplexOrder @version "2.0" @author "Business Analyst" {
    start @message "OrderReceived"
    
    task ValidateOrder (timeout=5m assignee="validator")
    
    xor OrderValid? {
        [validation_result == "valid"] -> ProcessOrder
        [validation_result == "invalid"] -> RejectOrder
        => ReviewManually
    }
    
    task ProcessOrder
    task RejectOrder
    task PackItems (assignee="warehouse")
    service GenerateInvoice (endpoint="/api/invoice")
    user NotifyCustomer (priority=high)
    
    task ShipOrder
    task FollowUp
    
    end @message "OrderCompleted"
    user ManualReview
    
    // Flows
    ProcessOrder -> PackItems
    ProcessOrder -> GenerateInvoice
    ProcessOrder -> NotifyCustomer
    PackItems -> ShipOrder
    GenerateInvoice -> ShipOrder
    NotifyCustomer -> ShipOrder
    ShipOrder -> FollowUp
    FollowUp -> end
    RejectOrder -> end
    ReviewManually -> ManualReview
    ManualReview -> ProcessOrder
}
